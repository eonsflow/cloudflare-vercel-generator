<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì„¤ì¹˜ê¸° í†µí•© í˜¸ì¶œê¸°</title>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      padding: 30px;
      background: #f0f2f5;
      line-height: 1.6;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 0.5em;
    }
    section {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 32px;
    }
    h2 {
      font-size: 18px;
      color: #2e3a59;
      margin-top: 0;
    }
    input {
      width: 100%;
      padding: 12px;
      margin: 8px 0 20px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      padding: 14px 24px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background-color: #5c6bc0;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #3f51b5;
    }
    .copy-link {
      background: #eef3f9;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <h1>ğŸ“¦ ìë™ì„¤ì¹˜ê¸° í†µí•© í˜¸ì¶œê¸°</h1>

  <section>
    <h2>1ï¸âƒ£ ì‹œíŠ¸ ì‚¬ë³¸ ë³µì‚¬</h2>
    <p>ì‹œíŠ¸ë¥¼ ë³µì‚¬í•´ì„œ ë³¸ì¸ ê³„ì •ìœ¼ë¡œ ê°€ì ¸ì˜¤ì„¸ìš”. <strong>Apps Scriptê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</strong></p>
    <div class="copy-link">
      ğŸ‘‰ <a href="https://docs.google.com/spreadsheets/d/12cfTITjRc56ACjKd0uy_xHKftd_oAOXeYnIw7JJScsg/copy" target="_blank">ì‹œíŠ¸ ì‚¬ë³¸ ë³µì‚¬í•˜ê¸°</a>
    </div>
  </section>

  <section>
    <h2>2ï¸âƒ£ ì‹œíŠ¸ì— Apps Script ë°°í¬</h2>
    <ol>
      <li>ìƒë‹¨ ë©”ë‰´ â†’ <strong>í™•ì¥ í”„ë¡œê·¸ë¨ &gt; Apps Script</strong> í´ë¦­</li>
      <li><strong>ì €ì¥</strong> í›„, ìƒë‹¨ <strong>ë°°í¬ &gt; í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë°°í¬</strong> í´ë¦­</li>
      <li>ì›¹ ì•± URL ë³µì‚¬í•˜ê¸°</li>
    </ol>
  </section>

  <section>
    <h2>3ï¸âƒ£ ì„¤ì¹˜ê¸° index.html ìƒì„±</h2>
    <p>ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³ , <strong>ì„¤ì¹˜ê¸° ë‹¤ìš´ë¡œë“œ</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>

    <label for="webAppUrl">âœ… Web App URL (GAS)</label>
    <input type="text" id="webAppUrl" placeholder="ìë™ ìƒì„±ë©ë‹ˆë‹¤" readonly />

    <label for="workerUrl">âœ… Worker URL</label>
    <input type="text" id="workerUrl" placeholder="ì˜ˆ: https://setup-ultimate.cuztoz.workers.dev" />

    <label for="sheetId">âœ… ì‹œíŠ¸ ID</label>
    <input type="text" id="sheetId" placeholder="ì˜ˆ: 12cfTITjRc56ACjKd0uy_xHKftd_oAOXeYnIw7JJScsg" />

    <button onclick="launchInstaller()">ğŸš€ ì„¤ì¹˜ê¸° ë‹¤ìš´ë¡œë“œ</button>
  </section>

  <section>
    <h2>4ï¸âƒ£ Netlify ì—…ë¡œë“œ</h2>
    <ol>
      <li><strong>https://app.netlify.com</strong> ì— ë¡œê·¸ì¸</li>
      <li>ì„¤ì¹˜ê¸°ì—ì„œ ë‹¤ìš´ë¡œë“œí•œ <code>index.html</code> ì—…ë¡œë“œ</li>
      <li>ê³µê°œëœ ì£¼ì†Œ ë³µì‚¬í•´ì„œ ë¸”ë¡œê·¸/ì¸ìŠ¤íƒ€/SNS ì—°ê²°</li>
    </ol>
  </section>

  <section>
    <h2>5ï¸âƒ£ Cloudflare Worker ì½”ë“œ ë³µì‚¬</h2>
    <p>Cloudflareì—ì„œ ì›Œì»¤ë¥¼ ìƒì„±í•œ í›„, ì•„ë˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ë©´ ìë™í™” ì‹œìŠ¤í…œì´ ì‘ë™ë©ë‹ˆë‹¤.</p>
    <textarea id="workerCode" style="width:100%; height:360px; border-radius:8px; padding:12px; font-family:monospace;">function extractKeywords(title) {
  if (!title || typeof title !== "string") return "";
  const stopwords = ["2025", "ê°€ì´ë“œ", "í•˜ëŠ”ë²•", "ë°©ë²•", "ì •ë¦¬", "ì •ë³´", "ì¶”ì²œ", "ë‰´ìŠ¤", "ê´€ë ¨", "ë°", "ì—ì„œ", "ìœ¼ë¡œ", "ì—", "ëŠ”", "ì´", "ê·¸", "ë¥¼", "ì˜", "í•œ", "ê°€", "ë„", "ë˜", "ìˆ˜"];
  const words = title
    .replace(/&lt;[^&gt;]*&gt;/g, '')
    .replace(/[^ê°€-í£a-zA-Z0-9\s]/g, '')
    .split(/\s+/)
    .map(w =&gt; w.toLowerCase())
    .filter(w =&gt; w.length &gt;= 2 && !stopwords.includes(w));

  const uniqueWords = [...new Set(words)];
  return uniqueWords.length &gt; 0 ? uniqueWords.slice(0, 5).join(",") : "";
}

async function fetchThumbnailFromItemUrl(itemUrl) {
  try {
    const res = await fetch(itemUrl, {
      headers: { 'User-Agent': 'Mozilla/5.0' }
    });
    const html = await res.text();
    const imgMatch = html.match(/&lt;img[^&gt;]+src=["'](https?:\/\/[^"'&gt;]+\.(jpg|jpeg|png|webp))["']/i);
    return imgMatch?.[1] || "";
  } catch {
    return "";
  }
}

async function extractFromRSS(rssHtml) {
  const isRSS = rssHtml.includes("&lt;rss") || rssHtml.includes("&lt;feed");

  if (isRSS) {
    const firstItem = rssHtml.match(/&lt;item&gt;([\s\S]*?)&lt;\/item&gt;/i)?.[1] || "";
    const rawTitle = firstItem.match(/&lt;title&gt;&lt;!\[CDATA\[(.*?)\]\]&gt;&lt;\/title&gt;/)?.[1]
                   || firstItem.match(/&lt;title&gt;(.*?)&lt;\/title&gt;/)?.[1]
                   || "ì œëª© ì—†ìŒ";

    let thumbnail =
      firstItem.match(/&lt;media:thumbnail[^&gt;]+url=["'](https?:\/\/[^"']+)["']/i)?.[1] ||
      firstItem.match(/&lt;media:content[^&gt;]+url=["'](https?:\/\/[^"']+)["']/i)?.[1] ||
      firstItem.match(/&lt;description[^&gt;]*&gt;&lt;!\[CDATA\[[\s\S]*?&lt;img[^&gt;]+src=["'](https?:\/\/[^"'&gt;]+\.(jpg|jpeg|png|webp))["']/i)?.[1] ||
      firstItem.match(/&lt;img[^&gt;]+src=["'](https?:\/\/[^"'&gt;]+\.(jpg|jpeg|png|webp))["']/i)?.[1] ||
      rssHtml.match(/&lt;meta[^&gt;]+property=["']og:image["'][^&gt;]+content=["'](https?:\/\/[^"']+)["']/i)?.[1] ||
      "";

    if (!thumbnail) {
      const itemUrl = firstItem.match(/&lt;link&gt;&lt;!\[CDATA\[(.*?)\]\]&gt;&lt;\/link&gt;/)?.[1]
                   || firstItem.match(/&lt;link&gt;(.*?)&lt;\/link&gt;/)?.[1];
      if (itemUrl) {
        thumbnail = await fetchThumbnailFromItemUrl(itemUrl);
      }
    }

    const descriptionContent = firstItem.match(/&lt;description(?:[^&gt;]*)&gt;&lt;!\[CDATA\[([\s\S]*?)\]\]&gt;&lt;\/description&gt;/i)?.[1] || "";
    const type = descriptionContent.includes("youtube.com/embed") ? "youtube" : "card";
    const keyword = extractKeywords(rawTitle);
    const category = firstItem.match(/&lt;category&gt;&lt;!\[CDATA\[(.*?)\]\]&gt;&lt;\/category&gt;/)?.[1]
                   || firstItem.match(/&lt;category&gt;(.*?)&lt;\/category&gt;/)?.[1]
                   || "ê¸°íƒ€";

    return { rawTitle, keyword, thumbnail, category, type };
  }

  const titleMatch = rssHtml.match(/&lt;h2[^&gt;]*class=["']tit_post["'][^&gt;]*&gt;(.*?)&lt;\/h2&gt;/i)
    || rssHtml.match(/&lt;title[^&gt;]*&gt;(.*?)&lt;\/title&gt;/i)
    || rssHtml.match(/&lt;h1[^&gt;]*&gt;(.*?)&lt;\/h1&gt;/i);
  const rawTitle = titleMatch?.[1]?.trim() || "ì œëª© ì—†ìŒ";

  const catMatch = rssHtml.match(/&lt;span[^&gt;]*class=["']category["'][^&gt;]*&gt;(.*?)&lt;\/span&gt;/i)
    || rssHtml.match(/&lt;category&gt;(.*?)&lt;\/category&gt;/i);
  const category = catMatch?.[1]?.trim() || "ê¸°íƒ€";

  let type = "card";
  const embedCheck = rssHtml.includes("youtube.com/embed");
  if (embedCheck) type = "youtube";

  let thumbnail =
    rssHtml.match(/&lt;media:thumbnail[^&gt;]+url=["'](https?:\/\/[^"']+)["']/i)?.[1] ||
    rssHtml.match(/&lt;media:content[^&gt;]+url=["'](https?:\/\/[^"']+)["']/i)?.[1] ||
    rssHtml.match(/&lt;description[^&gt;]*&gt;&lt;!\[CDATA\[[\s\S]*?&lt;img[^&gt;]+src=["'](https?:\/\/[^"'&gt;]+\.(jpg|jpeg|png|webp))["']/i)?.[1] ||
    rssHtml.match(/&lt;img[^&gt;]+src=["'](https?:\/\/[^"'&gt;]+\.(jpg|jpeg|png|webp))["']/i)?.[1] ||
    rssHtml.match(/&lt;meta[^&gt;]+property=["']og:image["'][^&gt;]+content=["'](https?:\/\/[^"']+)["']/i)?.[1] ||
    "";

  let keyword = extractKeywords(rawTitle);
  const keywordFallbackRaw =
    rssHtml.match(/&lt;meta[^&gt;]+name=["']keywords["'][^&gt;]+content=["']([^"']+)["']/i)?.[1] ||
    rssHtml.match(/&lt;meta[^&gt;]+property=["']og:description["'][^&gt;]+content=["']([^"']+)["']/i)?.[1] ||
    rssHtml.match(/&lt;p[^&gt;]*&gt;(.*?)&lt;\/p&gt;/is)?.[1];
  const fallbackKeyword = extractKeywords(keywordFallbackRaw || rawTitle);
  if (!keyword || keyword.split(",").length &lt; 2 || fallbackKeyword.split(",").length &gt; keyword.split(",").length) {
    keyword = fallbackKeyword;
  }

  return { rawTitle, keyword, thumbnail, category, type };
}

addEventListener("fetch", event =&gt; {
  event.respondWith(handleRequest(event.request));
});

async function handleRequest(request) {
  if (request.method === "OPTIONS") {
    return new Response(null, {
      status: 204,
      headers: {
        "Access-Control-Allow-Origin": "*",
        "Access-Control-Allow-Methods": "GET, POST, OPTIONS",
        "Access-Control-Allow-Headers": "Content-Type"
      }
    });
  }

  const url = new URL(request.url);
  const targetUrl = url.searchParams.get("link");
  const gasUrl = new URL(request.url).searchParams.get("gas");

  if (!targetUrl) {
    return new Response("âŒ Missing 'link' parameter", {
      status: 400,
      headers: { "Access-Control-Allow-Origin": "*" }
    });
  }

  try {
    const res = await fetch(targetUrl, {
      headers: { 'User-Agent': 'Mozilla/5.0' }
    });
    const rssHtml = await res.text();

    const { rawTitle, keyword, thumbnail, category, type } = await extractFromRSS(rssHtml);

    const gasResponse = await fetch(gasUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        mode: "view",
        link: targetUrl,
        data: { rawTitle, keyword, thumbnail, category, type }
      })
    });

    const gasText = await gasResponse.text();

    return new Response(JSON.stringify({
      status: "âœ… success",
      data: { thumbnail, keyword, type, category, rawTitle },
      gasResponse: gasText
    }), {
      headers: {
        "Content-Type": "application/json",
        "Access-Control-Allow-Origin": "*"
      }
    });

  } catch (err) {
    return new Response("âŒ ì˜¤ë¥˜ ë°œìƒ: " + err.toString(), {
      status: 500,
      headers: { "Access-Control-Allow-Origin": "*" }
    });
  }
}
</textarea>
    <button onclick="copyWorkerCode()">ğŸ“‹ ì½”ë“œ ë³µì‚¬í•˜ê¸°</button>
  </section>

  <script>
    function copyWorkerCode() {
      const el = document.getElementById("workerCode");
      el.select();
      document.execCommand("copy");
      alert("âœ… ì›Œì»¤ ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! Cloudflareì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.");
    }
  </script>

  <script>
    
  
<script>
function launchInstaller() {
  const workerUrl = document.getElementById('workerUrl').value.trim();
  const sheetId = document.getElementById('sheetId').value.trim();

  if (!workerUrl || !sheetId) {
    alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
    return;
  }

  const gasIndexWebApp = "https://script.google.com/macros/s/AKfycbwjl4SVTXWMxetubJWJtlifrp_KnBRueEMBPLZEsPXOFIKcHNkfVYYGIAhxXKIU3PZ6/exec";
  const downloadUrl = `${gasIndexWebApp}?sheet=${sheetId}&worker=${encodeURIComponent(workerUrl)}&title=ìë™ì„¤ì¹˜ê¸°&theme=dark&cat=ì „ì²´&max=100&today=ğŸ”¥ì¡°íšŒìˆ˜`;

  window.open(downloadUrl, "_blank");
}
</script>



<script>
function launchInstaller() {
  const workerUrl = document.getElementById('workerUrl').value.trim();
  const sheetId = document.getElementById('sheetId').value.trim();

  if (!workerUrl || !sheetId) {
    alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
    return;
  }

  const gasIndexWebApp = "https://script.google.com/macros/s/AKfycbwjl4SVTXWMxetubJWJtlifrp_KnBRueEMBPLZEsPXOFIKcHNkfVYYGIAhxXKIU3PZ6/exec";
  const downloadUrl = `${gasIndexWebApp}?sheet=${sheetId}&worker=${encodeURIComponent(workerUrl)}&title=ìë™ì„¤ì¹˜ê¸°&theme=dark&cat=ì „ì²´&max=100&today=ğŸ”¥ì¡°íšŒìˆ˜`;

  window.open(downloadUrl, "_blank");
}
</script>


</body>
</html>
